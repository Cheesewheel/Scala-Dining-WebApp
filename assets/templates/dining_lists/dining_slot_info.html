{% extends 'dining_lists/dining_slot.html' %}
{% load staticfiles %}
{% load form_extras %}



{% block details %}
    <div class="col-12 row m-0">
    {# Primary information #}
        <div class="col-12 col-md-10 row px-0">
            <div class="col-12 h3">
                {{ dining_list.dish }}
            </div>
            <div class="col-3">
                by
            </div>
            <div class="col-9 h4">
                {{ dining_list.claimed_by }}
                {% if dining_list.purchaser != None %}
                    and {{ dining_list.purchaser }}
                {% endif %}
            </div>
            <div class="col-9 offset-3">
                {{ dining_list.association }}
            </div>
            <div class="col-3 pt-3">Served at:</div>
            <div class="col-9 pt-3">
                {{ dining_list.date }}<br>
                <span class="h5">{{ dining_list.serve_time|date:"H:i" }}</span>
            </div>
            {% if dining_list.dinner_cost_single %}
                <div class="col-3 mt-3">
                    Meal cost
                </div>
                <div class="col-9 mt-3">
                    &euro; {{ dining_list.dinner_cost_single }}
                    <span>to be paid to {{ dining_list.get_purchaser }}</span>
                    {% if dining_list.payment_link %}
                        <br>
                        <a href="{{ dining_list.payment_link }}">{{ dining_list.payment_link }}</a>

                    {% endif %}
                </div>
            {% endif %}

        </div>
        {# Display the association image #}
        <div class="col-2 slot_image d-none d-md-flex"
             style="{% if dining_list.association.image %}background-image: url({{ dining_list.association.image.url }});{% endif %}">
        </div>
        {# Display options for changing dining_list stuff #}
        {% if can_change_settings %}
            {% url 'slot_change' day=date.day month=date.month year=date.year identifier=dining_list.association.slug as url %}
            <a class="btn btn-primary col-12 col-md-6 mt-3 " href={{ url }}>
                <i class="fas fa-tools"></i> Change information
            </a>
            {% if can_remove_list %}
            {% url "slot_delete" year=date.year month=date.month day=date.day identifier=dining_list.association.slug as url %}
            <a href="{{ url }}" class="btn btn-outline-danger col-12 col-md-6 mt-3"><i class="fas fa-trash-alt"></i> Remove Dininglist</a>
            {% endif %}
        {% endif %}
    </div>

    <hr class="col-12 my-3 p-0">

    <div class="col-12 row m-0">
    {# User status options #}
        {# Display the current status of the user #}
        {% if user_is_on_list %}
            <div class="alert alert-success col-12">
                <p class="mb-0">You are on this list</p>
            </div>
        {% elif user_can_add_self %}
            <div class="alert alert-warning col-12">
                <p class="mb-0">You are not on the dining list</p>
            </div>
        {% else %}
            <div class="alert alert-danger col-12">
                <p class="mb-0">You are not on this list and can no longer join</p>
            </div>
        {% endif %}

        {# Define the buttons #}
        {% if dining_list.is_open %}
            {# The user add/removal button #}
            {% if user_is_on_list %}
                {% url 'entry_remove' day=date.day month=date.month year=date.year identifier=dining_list.association.slug as url %}
                <form method="post"
                      action="{{ url }}?next={{ request.path_info }}"
                      class="col-12 col-md-6 p-0 my-md-0 my-3">
                    {% csrf_token %}
                    <button type="submit" class="btn-block btn btn-outline-warning">Sign out</button>
                </form>
            {% elif user_can_add_self %}
                {% url 'entry_add' day=date.day month=date.month year=date.year identifier=dining_list.association.slug as url%}
                <form method="post"
                      action="{{ url }}?next={{ request.path_info }}"
                      class="col-12 col-md-6 p-0 my-md-0 my-3">
                    {% csrf_token %}
                    <button type="submit" class="btn-block btn btn-primary">Sign up</button>
                </form>
            {% else %}
                <div class="btn-disabled btn col-12 col-md-6 ">You can not join this list</div>
            {% endif %}

            {% if user_can_add_others %}
                {% url 'entry_add' day=date.day month=date.month year=date.year identifier=dining_list.association.slug as url %}
                <a href="{{ url }}" class="btn btn-outline-primary col-12 col-md-6 ">Add others</a>
            {% endif %}
        {% else %}
            {% if user_can_add_others %}
                {# Add other button #}
                {% url 'entry_add' day=date.day month=date.month year=date.year identifier=dining_list.association.slug as url %}
                <a href="{{ url }}" class="btn btn-outline-primary col-12 col-md-6 offset-md-6">Add others</a>
            {% endif %}
        {% endif %}
    </div>

    <hr class="col-12 my-3 p-0">

    <div class="col-12 row m-0">
        <div class="col-12 col-md-10 row px-0">
            {% if dining_list.is_open %}
                <div class="col-3">
                    Open till
                </div>
                <div class="col-9 h5">
                    {% if dining_list.sign_up_deadline.date == dining_list.date %}
                        {{ dining_list.sign_up_deadline |date:"H:i" }}
                    {% else %}
                        {{ dining_list.sign_up_deadline |date:"l H:i" }}
                    {% endif %}
                </div>
            {% else %}
                <div class="col-9 offset-3">
                    Dining list is closed, contact {{ dining_list.claimed_by }} if you want to join
                </div>
            {% endif %}

            <div class="col-3 pt-3">Diners:</div>
            <div class="col-3 pt-3">
                <span class="h5">{{ dining_list.dining_entries.count }}</span> / {{ dining_list.max_diners }}
            </div>
            <div class="col-6 pt-3">
                {% if number_of_allergies > 0 %}
                    {{ number_of_allergies }} allerg{{ number_of_allergies|pluralize:"y,ies" }}
                {% endif %}
            </div>

            {% if dining_list.dining_entries.count < dining_list.min_diners %}
                <div class="col-3">Minimum diners:</div>
                <div class="col-9">
                    {{ dining_list.min_diners }}
                </div>
            {% endif %}

            <div class="col-12 mt-2"></div>

            <div class="col-3">
                Kitchen cost
            </div>
            <div class="col-9">
                &euro; {{ dining_list.kitchen_cost }}
                <span class="small">(automatically subtracted)</span>
            </div>
        </div>
    </div>

    <hr class="col-12 my-2 p-0">

    <div class="col-12">
        {% for comment in comments %}
            {% include 'snippets/snippet_comments.html' %}
        {% endfor %}
    </div>
    <form class="col-12" method="post">
        <textarea name="comment" class="col-12"></textarea>
        <input type="submit" value="Post" class="btn btn-block btn-primary"/>
        {% csrf_token %}
    </form>


{% endblock details %}